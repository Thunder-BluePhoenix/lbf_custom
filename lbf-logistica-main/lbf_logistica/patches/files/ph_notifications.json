{
  "name": "Material Request Notification p3",
  "owner": "Administrator",
  "modified_by": "Administrator",
  "docstatus": 0,
  "idx": 11,
  "archived": 0,
  "funnel_name": "Material Request Notification p3",
  "funnel_type": "Private",
  "status": "published",
  "viewport": "{\"x\":78.59554897739395,\"y\":284.622389811495,\"zoom\":1.0000000037558905}",
  "variable_list": "[]",
  "assistant_form_fields": "{}",
  "doctype": "Funnel",
  "funnel_access": [],
  "funnel_definition": [
    {
      "name": "j2g0ngrsjr",
      "owner": "Administrator",
      
      "modified_by": "Administrator",
      "docstatus": 0,
      "idx": 1,
      "data": "{\"doctype\":\"Material Request\",\"action\":\"after_insert\",\"submit\":true,\"variable_path_for_output\":\"\"}",
      "position": "{\"x\":600,\"y\":-135}",
      "type": "document_event_trigger",
      "id": "6xG08pb-28ylYWEwHqcaR",
      "element_type": "Trigger",
      "parent": "Material Request Notification p3",
      "parentfield": "funnel_definition",
      "parenttype": "Funnel",
      "doctype": "Funnel Definition"
    },
    {
      "name": "j2g0p12o53",
      "owner": "Administrator",
      
      "modified_by": "Administrator",
      "docstatus": 0,
      "idx": 2,
      "data": "{\"node_label\":\"Material request time check\",\"python_code\":\"doc = variables[\\\"doc\\\"]\\n\\n\\n\\nmr = frappe.get_doc(\\\"Material Request\\\", doc[\\\"name\\\"])\\n\\n\\ntimeline_settings = frappe.get_doc(\\\"Notification and Timeline Settings\\\")\\n\\n\\n#if not timeline_settings.start_time or not timeline_settings.ending_time:\\n #   return\\n\\ntransporter = mr.custom_transporter_name\\nsupplier = frappe.get_doc(\\\"Supplier\\\",transporter)\\nstart_time = frappe.utils.get_time(supplier.custom_cutoff_start_time)\\nend_time = frappe.utils.get_time(supplier.custom_cutoff_end_time)\\n\\n\\nroles = [row.roles for row in timeline_settings.notification_for_request_select_roles]\\n\\n\\ncurrent_time = frappe.utils.get_time(mr.creation)\\n\\n\\nif not (start_time <= current_time <= end_time):\\n\\n    \\n    users_with_roles = frappe.db.get_all(\\n        \\\"Has Role\\\",\\n        filters={\\n            \\\"role\\\": [\\\"in\\\", roles],\\n            \\\"parenttype\\\": \\\"User\\\"\\n        },\\n        fields=[\\\"parent as user\\\"],\\n        distinct=True\\n    )\\n\\n    \\n    usernames = [user.get(\\\"user\\\") for user in users_with_roles]\\n\\n    \\n    emails = frappe.db.get_all(\\n        \\\"User\\\",\\n        filters={\\\"name\\\": [\\\"in\\\", usernames]},\\n        fields=[\\\"email\\\"]\\n    )\\n\\n    \\n    email_list = [email.get(\\\"email\\\") for email in emails]\\n    email_string = \\\", \\\".join(email_list)\\n\\n    \\n    for user_entry in users_with_roles:\\n        user = user_entry.get(\\\"user\\\")\\n\\n        if user:\\n            notify = frappe.get_doc({\\n                \\\"doctype\\\": \\\"Notification Log\\\",\\n                \\\"subject\\\": \\\"Material Request for Peneus Hub created but not submitted\\\",\\n                \\\"type\\\": \\\"Alert\\\",\\n                \\\"document_type\\\": \\\"Material Request\\\",\\n                \\\"document_name\\\": mr.name,\\n                \\\"for_user\\\": user,\\n                \\\"from_user\\\": frappe.session.user,\\n            })\\n            notify.insert(ignore_permissions=True)\\n    variables[\\\"email_var\\\"] = email_string\\n   \\n\",\"skip_queue_and_execute_immediately\":false,\"execute_current_node_as_user\":\"\",\"submit\":true,\"variable_path_for_output\":\"\"}",
      "position": "{\"x\":600,\"y\":60}",
      "type": "exec_python",
      "id": "Bs2zcZ6s0LL0DfaUJYsI9",
      "element_type": "Action",
      "parent": "Material Request Notification p3",
      "parentfield": "funnel_definition",
      "parenttype": "Funnel",
      "doctype": "Funnel Definition"
    },
    {
      "name": "j2g0hl2t2e",
      "owner": "Administrator",
      
      "modified_by": "Administrator",
      "docstatus": 0,
      "idx": 3,
      "data": "{\"email_account\":\"\",\"select_template\":true,\"email_subject\":\"Test\",\"send_to_assigned_users\":false,\"recepients\":[{\"recepientField\":\"\",\"recipient\":\"\",\"cc\":\"\"}],\"link_doctype\":false,\"attach_prints\":false,\"submit\":true,\"recipients\":\"{{email_var}}\",\"cc\":\"\",\"bcc\":\"\",\"email_content\":\"<p>test</p>\",\"variable_path_for_output\":\"\",\"email_template\":\"Test\",\"createNewEmailTemplate\":false}",
      "position": "{\"x\":960,\"y\":225}",
      "type": "send_mail",
      "id": "DLkh_xfO2XrCkx9usOSZX",
      "element_type": "Action",
      "parent": "Material Request Notification p3",
      "parentfield": "funnel_definition",
      "parenttype": "Funnel",
      "doctype": "Funnel Definition"
    },
    {
      "name": "j2g0atlmi5",
      "owner": "Administrator",
      
      "modified_by": "Administrator",
      "docstatus": 0,
      "idx": 4,
      "data": "{\"node_label\":\"filter service\",\"use_python_expression\":true,\"submit\":true,\"variable_path_for_output\":\"\",\"expression\":\"doc = variables[\\\"doc\\\"]\\nif doc.custom_service == \\\"Peneus Hub\\\":\\n    return True\\nelse:\\n    return False\",\"filters\":[]}",
      "position": "{\"x\":585,\"y\":-30}",
      "type": "var_filter",
      "id": "ICHhmzoP78RrAnhiuujR6",
      "element_type": "Action",
      "parent": "Material Request Notification p3",
      "parentfield": "funnel_definition",
      "parenttype": "Funnel",
      "doctype": "Funnel Definition"
    },
    {
      "name": "j2g0skad59",
      "owner": "Administrator",
      
      "modified_by": "Administrator",
      "docstatus": 0,
      "idx": 5,
      "data": "{\"submit\":true}",
      "position": "{\"x\":900,\"y\":30}",
      "type": "stop_current_workflow",
      "id": "6fTF5iEL7OhCoyBJwzWrh",
      "element_type": "Action",
      "parent": "Material Request Notification p3",
      "parentfield": "funnel_definition",
      "parenttype": "Funnel",
      "doctype": "Funnel Definition"
    },
    {
      "name": "j2g0boit7r",
      "owner": "Administrator",
      
      "modified_by": "Administrator",
      "docstatus": 0,
      "idx": 6,
      "type": "smoothstep",
      "id": "reactflow__edge-Bs2zcZ6s0LL0DfaUJYsI9output-DLkh_xfO2XrCkx9usOSZXinput",
      "element_type": "edge",
      "targethandle": "input",
      "target": "DLkh_xfO2XrCkx9usOSZX",
      "sourcehandle": "output",
      "source": "Bs2zcZ6s0LL0DfaUJYsI9",
      "parent": "Material Request Notification p3",
      "parentfield": "funnel_definition",
      "parenttype": "Funnel",
      "doctype": "Funnel Definition"
    },
    {
      "name": "j2g0b5prv8",
      "owner": "Administrator",
      
      "modified_by": "Administrator",
      "docstatus": 0,
      "idx": 7,
      "type": "smoothstep",
      "id": "reactflow__edge-6xG08pb-28ylYWEwHqcaRoutput-ICHhmzoP78RrAnhiuujR6input",
      "element_type": "edge",
      "targethandle": "input",
      "target": "ICHhmzoP78RrAnhiuujR6",
      "sourcehandle": "output",
      "source": "6xG08pb-28ylYWEwHqcaR",
      "parent": "Material Request Notification p3",
      "parentfield": "funnel_definition",
      "parenttype": "Funnel",
      "doctype": "Funnel Definition"
    },
    {
      "name": "j2g0jm0m2n",
      "owner": "Administrator",
      
      "modified_by": "Administrator",
      "docstatus": 0,
      "idx": 8,
      "type": "smoothstep",
      "id": "reactflow__edge-ICHhmzoP78RrAnhiuujR6yes-Bs2zcZ6s0LL0DfaUJYsI9input",
      "element_type": "edge",
      "targethandle": "input",
      "target": "Bs2zcZ6s0LL0DfaUJYsI9",
      "sourcehandle": "yes",
      "source": "ICHhmzoP78RrAnhiuujR6",
      "parent": "Material Request Notification p3",
      "parentfield": "funnel_definition",
      "parenttype": "Funnel",
      "doctype": "Funnel Definition"
    },
    {
      "name": "j2g067p68q",
      "owner": "Administrator",
      
      "modified_by": "Administrator",
      "docstatus": 0,
      "idx": 9,
      "type": "smoothstep",
      "id": "reactflow__edge-ICHhmzoP78RrAnhiuujR6no-6fTF5iEL7OhCoyBJwzWrhinput",
      "element_type": "edge",
      "targethandle": "input",
      "target": "6fTF5iEL7OhCoyBJwzWrh",
      "sourcehandle": "no",
      "source": "ICHhmzoP78RrAnhiuujR6",
      "parent": "Material Request Notification p3",
      "parentfield": "funnel_definition",
      "parenttype": "Funnel",
      "doctype": "Funnel Definition"
    }
  ],
  "__last_sync_on": "2024-12-27T12:35:47.100Z"
}